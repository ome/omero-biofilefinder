
<html>
    <head>
        <title>Open with Biofile Finder</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0px;
                color: #333;
            }

            .button_link {
                display: inline-block;
                border: solid grey 1px;
                border-radius: 5px;
                background-color: lightblue;
                padding: 10px 20px;
                text-decoration: none;
                color: black;
            }
            .navbar {
                color: white;
                background-color: #202020;
                padding: 10px;
                border-bottom: solid black 1px;
                margin-bottom: 20px;
                box-shadow: 0px 3px 4px 0px rgba(0, 0, 0, 0.3);
            }
            h1, h2 {
                margin: 0px;
                font-size: 24px;
                font-weight: 200;
            }
            h2 {
                font-size: 20px;
            }
            .content {
                max-width: 800px;
                margin: 0 auto;
            }
        </style>
    </head>

    <body>
      <div class="navbar">
          <h1>OMERO BioFile Finder</h1>
      </div>

      <div class="content">
        <h1>Open with BioFile Finder...</h1>
        <p>
            {{ target.dtype | capfirst }} name: <b>{{ target.name }}</b> <br/>
            Image count: <b>{{ img_count }}</b>
        </p>
        <p>
            BioFile Finder loads Key-Value pairs from Images in OMERO.
        </p>

        <p>
            <a href="{{ bff_url}}" class="button_link">Open {{ target.dtype | capfirst }} in Biofile Finder</a>
        <p>

        {% if img_count > 400 or bff_parquet_anns %}
        <div style="border-radius: 10px; border: solid rgb(194, 193, 193) 1px; padding: 10px; background-color: #f0f0f0; margin-bottom: 20px;">
          <h2>Alternative option: Use a script to export Key-Value pairs</h2>

          <p>
            Exporting Key-Value pairs for {{ img_count }} Images may time out using the link above.
            Instead, you can export Key-Value pairs to a parquet file
            (attached to the {{ target.dtype | capfirst }}) using an OMERO.script on the server: <br>

            Select the {{ target.dtype | capfirst }} in the webclient, then use the OMERO.script menu and choose:
            <code>annotation scripts > Export to Biofile Finder</code>.
            Run the script with default input values, then refresh this page.
          </p>

          {% if bff_parquet_anns %}
            <h3>Existing Parquet files:</h3>
            <ul>
            {% for ann in bff_parquet_anns %}
                <li>
                    {{ ann.name }} (Created: {{ ann.created }} Size: {{ ann.size }} bytes)
                    <a class="button_link" href="{{ ann.bbf_url }}">Open Parquet in BioFile Finder</a>
                </li>
            {% endfor %}
            </ul>
          {% else %}
            <p>
                No parquet files currently attached to {{ target.dtype | capfirst }}:{{ target.id }}.
            </p>
          {% endif %}

          {% if table_anns %}
            <h3>OMERO.tables:</h3>
            <ul>
            {% for ann in table_anns %}
              <li>
                  {{ ann.name }} (Created: {{ ann.created }} Size: {{ ann.size }} bytes)
                  <a class="button_link" href="{{ ann.bff_url }}">Open table in BioFile Finder</a>
              </li>
            {% endfor %}
            </ul>
          {% else %}
            <p>
              No OMERO.table files currently attached to {{ target.dtype | capfirst }}:{{ target.id }}.
            </p>
          {% endif %}

          </div>
        {% endif %}
        <h2>Using Biofile Finder</h2>

        <p>

          In BioFile Finder, you can open selected Images in the OMERO webclient by using the
          "Open File" button and choosing "Browser".
        </p>
        <img src="{% static 'omero_biofilefinder/images/bff_open_file.png' %}" alt="Open File in Browser" style="float:left; margin-right: 15px; width: 300px; height: auto;">
      </div>
    </body>
</html>
